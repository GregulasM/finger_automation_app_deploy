import { readonly, ref } from "vue";

export const useI18n = () => {
  const locale = ref<"en" | "ru">("en");

  const translations: Record<string, Record<string, string>> = {
    en: {
      // Common
      "common.edit": "Edit",
      "common.delete": "Delete",
      "common.save": "Save",
      "common.cancel": "Cancel",
      "common.back": "← Back",
      "common.loading": "Loading...",
      "common.user": "User",
      "common.logout": "Logout",
      "common.signIn": "Sign in",
      "common.new": "New",
      "common.home": "Home",
      "common.editor": "Editor",
      "common.close": "Close",

      // Navigation
      "nav.home": "Home",
      "nav.workflows": "Workflows",
      "nav.editor": "Editor",
      "nav.newWorkflow": "New workflow",
      "nav.openWorkflowEditor": "Open workflow editor",
      "nav.viewDashboard": "View dashboard",

      // Index page
      "index.title": "Automate your stack with visual workflows.",
      "index.description": "Build triggers, chain actions, and ship workflows in minutes. Connect Webhooks, Schedules, and HTTP requests with resilient serverless execution.",
      "index.webhookTriggers": "Webhook triggers",
      "index.cronSchedules": "Cron schedules",
      "index.jsonFirstWorkflows": "JSON-first workflows",
      "index.fromTriggerToAction": "From trigger to action",
      "index.fromTriggerToActionDesc": "Design flows visually, then store the graph as JSONB with full execution history.",
      "index.reliableExecution": "Reliable execution",
      "index.reliableExecutionDesc": "QStash handles queueing and retries while the runner isolates each workflow run.",
      "index.auditReadyLogs": "Audit-ready logs",
      "index.auditReadyLogsDesc": "Step-by-step logging, timings, and outputs stay available for every run.",

      // Workflows page
      "workflows.title": "Workflows",
      "workflows.description": "Track activity, performance, and recent executions.",
      "workflows.newWorkflow": "New workflow",
      "workflows.workflowList": "Workflow list",
      "workflows.loadingWorkflows": "Loading workflows...",
      "workflows.selectWorkflow": "Select a workflow",
      "workflows.overview": "Overview",
      "workflows.triggerType": "Trigger type",
      "workflows.lastUpdated": "Last updated",
      "workflows.updated": "Updated",
      "workflows.created": "Created",
      "workflows.totalRuns": "Total runs",
      "workflows.successRate": "Success rate",
      "workflows.avgDuration": "Avg duration",
      "workflows.lastRun": "Last run",
      "workflows.noRunsYet": "No runs yet",
      "workflows.executionHistory": "Execution history",
      "workflows.loadingExecutions": "Loading executions...",
      "workflows.noExecutionsYet": "No executions yet.",
      "workflows.steps": "Steps",
      "workflows.loadingStats": "Loading stats...",
      "workflows.endpoint": "Endpoint",
      "workflows.deleteConfirm": "Are you sure you want to delete this workflow?",
      "workflows.deleteFailed": "Failed to delete workflow. Please try again.",

      // Workflow Editor
      "editor.title": "Workflow Editor",
      "editor.description": "Build and configure your automation flow.",
      "editor.workflowName": "Workflow name",
      "editor.active": "Active",
      "editor.trigger": "Trigger",
      "editor.notSet": "Not set",
      "editor.saving": "Saving...",
      "editor.save": "Save",
      "editor.saveFailed": "Save failed",
      "editor.loadFailed": "Load failed",
      "editor.blocks": "Blocks",
      "editor.blockDetails": "Block details",
      "editor.addToCanvas": "Add to canvas",
      "editor.tipDrag": "Tip: drag to place it precisely.",
      "editor.mobileHint": "Open the blocks menu to drag blocks onto the canvas or tap a block and use \"Add to canvas\".",
      "editor.clickBlock": "Click a block to see what it does and how to configure it.",
      "editor.nodeSettings": "Node settings",
      "editor.delete": "Delete",
      "editor.selectNode": "Select a node to edit its settings.",
      "editor.aboutBlock": "About this block",
      "editor.configureBlock": "Configure this block to control how it behaves.",
      "editor.webhookUrl": "Webhook URL",
      "editor.saveToGenerateWebhook": "Save to generate the webhook URL",
      "editor.generateEndpoint": "Generate endpoint",
      "editor.savingCreatesUrl": "Saving creates a stable URL for this trigger.",
      "editor.cronExpression": "Cron expression",
      "editor.timezone": "Timezone",
      "editor.inboundEmailEndpoint": "Inbound email endpoint",
      "editor.saveToGenerateEmail": "Save to generate the inbound endpoint",
      "editor.saveOnceForUrl": "Save once to get the inbound URL.",
      "editor.configureEmailProvider": "Configure your inbound email provider to POST to this URL.",
      "editor.url": "URL",
      "editor.method": "Method",
      "editor.headers": "Headers (JSON)",
      "editor.body": "Body (JSON or text)",
      "editor.to": "To",
      "editor.subject": "Subject",
      "editor.html": "HTML",
      "editor.text": "Text",
      "editor.botToken": "Bot token",
      "editor.chatId": "Chat ID",
      "editor.message": "Message",
      "editor.parseMode": "Parse mode",
      "editor.model": "Model",
      "editor.operation": "Operation",
      "editor.args": "Args (JSON)",
      "editor.expression": "Expression",
      "editor.mapping": "Mapping (JSON)",
      "editor.errorHandling": "Error handling",
      "editor.retryCount": "Retry count",
      "editor.retryDelay": "Retry delay (ms)",
      "editor.onError": "On error",
      "editor.notifyEmail": "Notify email",
      "editor.workflowNameRequired": "Workflow name is required.",
      "editor.addTriggerBeforeSaving": "Add a trigger block before saving.",
      "editor.saved": "Saved",
      "editor.workflowUpdated": "Workflow updated.",
      "editor.workflowSaved": "Workflow saved.",
      
      // Palette blocks translations
      "editor.palette.webhook.summary": "Incoming HTTP request triggers the workflow.",
      "editor.palette.webhook.details": "Expose a webhook endpoint and start the flow when data is posted.",
      "editor.palette.webhook.tip1": "Use JSON payloads from external apps.",
      "editor.palette.webhook.tip2": "Save once to generate the URL.",
      "editor.palette.schedule.summary": "Run the workflow on a cron schedule.",
      "editor.palette.schedule.details": "Define a cron expression and timezone to trigger automatically.",
      "editor.palette.schedule.tip1": "Example: */5 * * * *",
      "editor.palette.schedule.tip2": "Timezone defaults to UTC.",
      "editor.palette.email-trigger.summary": "Trigger when an inbound email arrives.",
      "editor.palette.email-trigger.details": "Point your inbound email provider to the generated endpoint.",
      "editor.palette.email-trigger.tip1": "Providers can POST email payloads.",
      "editor.palette.email-trigger.tip2": "Save once to get the URL.",
      "editor.palette.http-request.summary": "Send an HTTP request to an API.",
      "editor.palette.http-request.details": "Configure method, headers, and body. The response becomes the next step input.",
      "editor.palette.http-request.tip1": "Use output from previous steps.",
      "editor.palette.http-request.tip2": "Timeout defaults to 15s.",
      "editor.palette.email-action.summary": "Send an email notification.",
      "editor.palette.email-action.details": "Uses your configured email service with HTML or text content.",
      "editor.palette.email-action.tip1": "Provide recipient and subject.",
      "editor.palette.email-action.tip2": "HTML is optional.",
      "editor.palette.telegram.summary": "Send a message to Telegram.",
      "editor.palette.telegram.details": "Requires a bot token and the target chat ID.",
      "editor.palette.telegram.tip1": "Create a bot via BotFather.",
      "editor.palette.telegram.tip2": "Use the chat ID of your target.",
      "editor.palette.database.summary": "Run a database operation.",
      "editor.palette.database.details": "Executes a Prisma operation against your database.",
      "editor.palette.database.tip1": "Model name matches Prisma client.",
      "editor.palette.database.tip2": "Args must be valid JSON.",
      "editor.palette.transformation.summary": "Transform or filter the payload.",
      "editor.palette.transformation.details": "Use an expression or mapping to shape data between steps.",
      "editor.palette.transformation.tip1": "Expression returns new payload.",
      "editor.palette.transformation.tip2": "Mapping can pick fields by path.",
      "editor.palette.role.trigger": "trigger",
      "editor.palette.role.action": "action",

      // Auth
      "auth.welcomeBack": "Welcome back",
      "auth.signInDescription": "Sign in to manage your workflows and triggers.",
      "auth.createAccount": "Create your account",
      "auth.startBuilding": "Start building automations in minutes.",
      "auth.email": "Email",
      "auth.password": "Password",
      "auth.name": "Name",
      "auth.signIn": "Sign in",
      "auth.createAccountButton": "Create account",
      "auth.dontHaveAccount": "Don't have an account?",
      "auth.alreadyHaveAccount": "Already have an account?",
      "auth.createOne": "Create one",
      "auth.loginFailed": "Login failed",
      "auth.registrationFailed": "Registration failed",
      "auth.unableToLogin": "Unable to login.",
      "auth.unableToRegister": "Unable to register.",
      "auth.enterValidEmail": "Enter a valid email.",
      "auth.passwordMinLength": "Password must be at least 8 characters.",
      "auth.nameMinLength": "Name must be at least 2 characters.",
      "auth.nameMaxLength": "Name must be under 80 characters.",
      "auth.nameInvalidChars": "Use Russian or English letters only.",
      
      // Language
      "lang.english": "English",
      "lang.russian": "Русский",
    },
    ru: {
      // Common
      "common.edit": "Редактировать",
      "common.delete": "Удалить",
      "common.save": "Сохранить",
      "common.cancel": "Отмена",
      "common.back": "← Назад",
      "common.loading": "Загрузка...",
      "common.user": "Пользователь",
      "common.logout": "Выйти",
      "common.signIn": "Войти",
      "common.new": "Новый",
      "common.home": "Главная",
      "common.editor": "Редактор",
      "common.close": "Закрыть",

      // Navigation
      "nav.home": "Главная",
      "nav.workflows": "Workflows",
      "nav.editor": "Редактор",
      "nav.newWorkflow": "Новый workflow",
      "nav.openWorkflowEditor": "Открыть редактор workflows",
      "nav.viewDashboard": "Просмотр панели",

      // Index page
      "index.title": "Автоматизируйте свой стек с помощью визуальных workflows.",
      "index.description": "Создавайте триггеры, связывайте действия и запускайте workflows за минуты. Подключайте Webhooks, Расписания и HTTP-запросы с надежным serverless выполнением.",
      "index.webhookTriggers": "Webhook триггеры",
      "index.cronSchedules": "Cron расписания",
      "index.jsonFirstWorkflows": "JSON-first workflows",
      "index.fromTriggerToAction": "От триггера к действию",
      "index.fromTriggerToActionDesc": "Проектируйте потоки визуально, затем сохраняйте граф как JSONB с полной историей выполнения.",
      "index.reliableExecution": "Надежное выполнение",
      "index.reliableExecutionDesc": "QStash обрабатывает очереди и повторы, пока runner изолирует каждый запуск workflow.",
      "index.auditReadyLogs": "Готовые к аудиту логи",
      "index.auditReadyLogsDesc": "Пошаговое логирование, тайминги и результаты остаются доступными для каждого запуска.",

      // Workflows page
      "workflows.title": "Workflows",
      "workflows.description": "Отслеживайте активность, производительность и недавние выполнения.",
      "workflows.newWorkflow": "Новый workflow",
      "workflows.workflowList": "Список workflows",
      "workflows.loadingWorkflows": "Загрузка workflows...",
      "workflows.selectWorkflow": "Выберите workflow",
      "workflows.overview": "Обзор",
      "workflows.triggerType": "Тип триггера",
      "workflows.lastUpdated": "Последнее обновление",
      "workflows.updated": "Обновлен",
      "workflows.created": "Создан",
      "workflows.totalRuns": "Всего запусков",
      "workflows.successRate": "Процент успеха",
      "workflows.avgDuration": "Средняя длительность",
      "workflows.lastRun": "Последний запуск",
      "workflows.noRunsYet": "Запусков пока нет",
      "workflows.executionHistory": "История выполнений",
      "workflows.loadingExecutions": "Загрузка выполнений...",
      "workflows.noExecutionsYet": "Выполнений пока нет.",
      "workflows.steps": "Шаги",
      "workflows.loadingStats": "Загрузка статистики...",
      "workflows.endpoint": "Эндпоинт",
      "workflows.deleteConfirm": "Вы уверены, что хотите удалить этот workflow?",
      "workflows.deleteFailed": "Не удалось удалить workflow. Попробуйте еще раз.",

      // Workflow Editor
      "editor.title": "Редактор Workflow",
      "editor.description": "Создавайте и настраивайте свой поток автоматизации.",
      "editor.workflowName": "Имя workflow",
      "editor.active": "Активен",
      "editor.trigger": "Триггер",
      "editor.notSet": "Не установлен",
      "editor.saving": "Сохранение...",
      "editor.save": "Сохранить",
      "editor.saveFailed": "Ошибка сохранения",
      "editor.loadFailed": "Ошибка загрузки",
      "editor.blocks": "Блоки",
      "editor.blockDetails": "Детали блока",
      "editor.addToCanvas": "Добавить на холст",
      "editor.tipDrag": "Подсказка: перетащите для точного размещения.",
      "editor.mobileHint": "Откройте меню блоков, перетащите блоки на холст или нажмите «Добавить на холст» в деталях блока.",
      "editor.clickBlock": "Нажмите на блок, чтобы увидеть, что он делает и как его настроить.",
      "editor.nodeSettings": "Настройки узла",
      "editor.delete": "Удалить",
      "editor.selectNode": "Выберите узел для редактирования его настроек.",
      "editor.aboutBlock": "О блоке",
      "editor.configureBlock": "Настройте этот блок, чтобы контролировать его поведение.",
      "editor.webhookUrl": "Webhook URL",
      "editor.saveToGenerateWebhook": "Сохраните, чтобы сгенерировать webhook URL",
      "editor.generateEndpoint": "Сгенерировать endpoint",
      "editor.savingCreatesUrl": "Сохранение создает стабильный URL для этого триггера.",
      "editor.cronExpression": "Cron выражение",
      "editor.timezone": "Часовой пояс",
      "editor.inboundEmailEndpoint": "Endpoint входящей почты",
      "editor.saveToGenerateEmail": "Сохраните, чтобы сгенерировать endpoint",
      "editor.saveOnceForUrl": "Сохраните один раз, чтобы получить URL.",
      "editor.configureEmailProvider": "Настройте ваш провайдер входящей почты для отправки POST на этот URL.",
      "editor.url": "URL",
      "editor.method": "Метод",
      "editor.headers": "Заголовки (JSON)",
      "editor.body": "Тело (JSON или текст)",
      "editor.to": "Кому",
      "editor.subject": "Тема",
      "editor.html": "HTML",
      "editor.text": "Текст",
      "editor.botToken": "Токен бота",
      "editor.chatId": "ID чата",
      "editor.message": "Сообщение",
      "editor.parseMode": "Режим парсинга",
      "editor.model": "Модель",
      "editor.operation": "Операция",
      "editor.args": "Аргументы (JSON)",
      "editor.expression": "Выражение",
      "editor.mapping": "Маппинг (JSON)",
      "editor.errorHandling": "Обработка ошибок",
      "editor.retryCount": "Количество повторов",
      "editor.retryDelay": "Задержка повтора (мс)",
      "editor.onError": "При ошибке",
      "editor.notifyEmail": "Email для уведомлений",
      "editor.workflowNameRequired": "Имя workflow обязательно.",
      "editor.addTriggerBeforeSaving": "Добавьте блок триггера перед сохранением.",
      "editor.saved": "Сохранено",
      "editor.workflowUpdated": "Workflow обновлен.",
      "editor.workflowSaved": "Workflow сохранен.",
      
      // Palette blocks translations
      "editor.palette.webhook.summary": "Входящий HTTP-запрос запускает workflow.",
      "editor.palette.webhook.details": "Предоставьте webhook endpoint и запустите поток при отправке данных.",
      "editor.palette.webhook.tip1": "Используйте JSON payloads из внешних приложений.",
      "editor.palette.webhook.tip2": "Сохраните один раз, чтобы сгенерировать URL.",
      "editor.palette.schedule.summary": "Запускайте workflow по cron расписанию.",
      "editor.palette.schedule.details": "Определите cron выражение и часовой пояс для автоматического запуска.",
      "editor.palette.schedule.tip1": "Пример: */5 * * * *",
      "editor.palette.schedule.tip2": "Часовой пояс по умолчанию UTC.",
      "editor.palette.email-trigger.summary": "Запуск при получении входящего email.",
      "editor.palette.email-trigger.details": "Направьте вашего провайдера входящей почты на сгенерированный endpoint.",
      "editor.palette.email-trigger.tip1": "Провайдеры могут отправлять POST запросы с email payloads.",
      "editor.palette.email-trigger.tip2": "Сохраните один раз, чтобы получить URL.",
      "editor.palette.http-request.summary": "Отправьте HTTP-запрос к API.",
      "editor.palette.http-request.details": "Настройте метод, заголовки и тело. Ответ становится входными данными следующего шага.",
      "editor.palette.http-request.tip1": "Используйте вывод предыдущих шагов.",
      "editor.palette.http-request.tip2": "Таймаут по умолчанию 15 секунд.",
      "editor.palette.email-action.summary": "Отправьте email уведомление.",
      "editor.palette.email-action.details": "Использует настроенный email сервис с HTML или текстовым содержимым.",
      "editor.palette.email-action.tip1": "Укажите получателя и тему.",
      "editor.palette.email-action.tip2": "HTML опционален.",
      "editor.palette.telegram.summary": "Отправьте сообщение в Telegram.",
      "editor.palette.telegram.details": "Требуется токен бота и ID целевого чата.",
      "editor.palette.telegram.tip1": "Создайте бота через BotFather.",
      "editor.palette.telegram.tip2": "Используйте ID чата вашей цели.",
      "editor.palette.database.summary": "Выполните операцию с базой данных.",
      "editor.palette.database.details": "Выполняет операцию Prisma против вашей базы данных.",
      "editor.palette.database.tip1": "Имя модели соответствует Prisma client.",
      "editor.palette.database.tip2": "Аргументы должны быть валидным JSON.",
      "editor.palette.transformation.summary": "Преобразуйте или отфильтруйте payload.",
      "editor.palette.transformation.details": "Используйте выражение или маппинг для формирования данных между шагами.",
      "editor.palette.transformation.tip1": "Выражение возвращает новый payload.",
      "editor.palette.transformation.tip2": "Маппинг может выбирать поля по пути.",
      "editor.palette.role.trigger": "триггер",
      "editor.palette.role.action": "действие",

      // Auth
      "auth.welcomeBack": "Добро пожаловать",
      "auth.signInDescription": "Войдите, чтобы управлять своими workflows и триггерами.",
      "auth.createAccount": "Создайте аккаунт",
      "auth.startBuilding": "Начните создавать автоматизации за минуты.",
      "auth.email": "Email",
      "auth.password": "Пароль",
      "auth.name": "Имя",
      "auth.signIn": "Войти",
      "auth.createAccountButton": "Создать аккаунт",
      "auth.dontHaveAccount": "Нет аккаунта?",
      "auth.alreadyHaveAccount": "Уже есть аккаунт?",
      "auth.createOne": "Создать",
      "auth.loginFailed": "Ошибка входа",
      "auth.registrationFailed": "Ошибка регистрации",
      "auth.unableToLogin": "Не удалось войти.",
      "auth.unableToRegister": "Не удалось зарегистрироваться.",
      "auth.enterValidEmail": "Введите корректный email.",
      "auth.passwordMinLength": "Пароль должен содержать минимум 8 символов.",
      "auth.nameMinLength": "Имя должно содержать минимум 2 символа.",
      "auth.nameMaxLength": "Имя должно содержать не более 80 символов.",
      "auth.nameInvalidChars": "Используйте только русские или английские буквы.",
      
      // Language
      "lang.english": "English",
      "lang.russian": "Русский",
    },
  };

  const t = (key: string): string => {
    const currentLocale = locale.value;
    return translations[currentLocale]?.[key] || key;
  };

  const setLocale = (newLocale: "en" | "ru") => {
    locale.value = newLocale;
    if (process.client) {
      localStorage.setItem("locale", newLocale);
    }
  };

  // Load locale from localStorage on client
  if (process.client) {
    const savedLocale = localStorage.getItem("locale") as "en" | "ru" | null;
    if (savedLocale && (savedLocale === "en" || savedLocale === "ru")) {
      locale.value = savedLocale;
    }
  }

  return {
    t,
    locale: readonly(locale),
    setLocale,
  };
};
